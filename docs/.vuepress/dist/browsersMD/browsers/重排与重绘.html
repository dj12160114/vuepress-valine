<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器渲染的重排与重绘 | 西毒</title>
    <meta name="description" content="vuepress vue blog">
    <link rel="icon" href="/dj-blog/img/icon.jpg">
    
    <link rel="preload" href="/dj-blog/assets/css/0.styles.9276223b.css" as="style"><link rel="preload" href="/dj-blog/assets/js/app.5965bf92.js" as="script"><link rel="preload" href="/dj-blog/assets/js/2.6df7a54b.js" as="script"><link rel="preload" href="/dj-blog/assets/js/8.c3ac8272.js" as="script"><link rel="prefetch" href="/dj-blog/assets/js/10.c052912e.js"><link rel="prefetch" href="/dj-blog/assets/js/11.d326218d.js"><link rel="prefetch" href="/dj-blog/assets/js/12.c99a7865.js"><link rel="prefetch" href="/dj-blog/assets/js/13.d5c9844e.js"><link rel="prefetch" href="/dj-blog/assets/js/14.59d84952.js"><link rel="prefetch" href="/dj-blog/assets/js/15.dd959b83.js"><link rel="prefetch" href="/dj-blog/assets/js/16.b9f26365.js"><link rel="prefetch" href="/dj-blog/assets/js/17.2541297d.js"><link rel="prefetch" href="/dj-blog/assets/js/18.44113780.js"><link rel="prefetch" href="/dj-blog/assets/js/19.24719164.js"><link rel="prefetch" href="/dj-blog/assets/js/20.ec44912b.js"><link rel="prefetch" href="/dj-blog/assets/js/21.c57eafbe.js"><link rel="prefetch" href="/dj-blog/assets/js/3.c9c8a28b.js"><link rel="prefetch" href="/dj-blog/assets/js/4.db483a68.js"><link rel="prefetch" href="/dj-blog/assets/js/5.797b1d00.js"><link rel="prefetch" href="/dj-blog/assets/js/6.5f4b6258.js"><link rel="prefetch" href="/dj-blog/assets/js/7.c3141a72.js"><link rel="prefetch" href="/dj-blog/assets/js/9.6e6f3dcd.js">
    <link rel="stylesheet" href="/dj-blog/assets/css/0.styles.9276223b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dj-blog/" class="home-link router-link-active"><!----> <span class="site-name">西毒</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dj-blog/htmlMD/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/dj-blog/cssMD/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/dj-blog/jsMD/" class="nav-link">JS</a></div><div class="nav-item"><a href="/dj-blog/browsersMD/" class="nav-link router-link-active">HTTP与浏览器</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Concat</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_41554071" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dj12160114" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dj-blog/htmlMD/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/dj-blog/cssMD/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/dj-blog/jsMD/" class="nav-link">JS</a></div><div class="nav-item"><a href="/dj-blog/browsersMD/" class="nav-link router-link-active">HTTP与浏览器</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Concat</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_41554071" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dj12160114" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/dj-blog/browsersMD/" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Browsers</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dj-blog/browsersMD/browsers/重排与重绘.html" class="active sidebar-link">重排与重绘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dj-blog/browsersMD/browsers/重排与重绘.html#浏览器渲染html的步骤：" class="sidebar-link">浏览器渲染HTML的步骤：</a></li><li class="sidebar-sub-header"><a href="/dj-blog/browsersMD/browsers/重排与重绘.html#重排（relayout-reflow）" class="sidebar-link">重排（Relayout/Reflow）</a></li><li class="sidebar-sub-header"><a href="/dj-blog/browsersMD/browsers/重排与重绘.html#重绘（repainting）" class="sidebar-link">重绘（Repainting）</a></li><li class="sidebar-sub-header"><a href="/dj-blog/browsersMD/browsers/重排与重绘.html#性能优化" class="sidebar-link">性能优化</a></li></ul></li><li><a href="/dj-blog/browsersMD/http/HTTP.html" class="sidebar-link">HTTP</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器渲染的重排与重绘"><a href="#浏览器渲染的重排与重绘" aria-hidden="true" class="header-anchor">#</a> 浏览器渲染的重排与重绘</h1> <h2 id="浏览器渲染html的步骤："><a href="#浏览器渲染html的步骤：" aria-hidden="true" class="header-anchor">#</a> 浏览器渲染HTML的步骤：</h2> <p>HTML渲染大致分为以下几步：</p> <ol><li><code>HTML</code> 被<code>HTML</code> 解析器解析成 <code>DOM Tree</code>， <code>CSS</code> 则被 <code>CSS</code> 解析器解析成 <code>CSSOM Tree</code>；</li> <li><code>DOM Tree</code> 和 <code>CSSOM Tree</code>解析完成之后，被附加到一起，形成渲染树 （<code>Render Tree</code>）;</li> <li>节点信息计算（重排），这个过程被叫做 <code>Layout</code> ( <code>Webkit</code> )或者 <code>Reflow</code> ( <code>Mozila</code> )，即根据渲染树计算每个节点的几何信息；</li> <li>渲染绘制（重绘），这个过程叫做 <code>Painting</code> 或者 <code>Repaint</code> ，即根据计算好的信息绘制整个页面。</li></ol> <p>以上4步简述浏览器的一次渲染过程，理论上，每一次的 <code>DOM</code> 更改或者 <code>CSS</code> 几何属性更改，都会引起一次浏览器的重排/重绘过程，而如果是 <code>CSS</code> 的非几何属性更改，则只会引起重绘过程。</p> <p>所以，<strong>重排一定引起重绘，重绘不一定引起重排</strong>。</p> <h2 id="重排（relayout-reflow）"><a href="#重排（relayout-reflow）" aria-hidden="true" class="header-anchor">#</a> 重排（Relayout/Reflow）</h2> <p>首先，浏览器渲染页面默认采用的是流式布局模型。</p> <p>所谓重排，实际上是根据渲染树中每个渲染对象的信息，计算出各自渲染对象的几何信息（ <code>DOM</code> 对象的位置和尺寸大小 ），并将其安置在界面的正确位置。</p> <p>由于浏览器渲染界面是基于流式布局模型的，也就是某一个 <code>DOM</code> 节点信息更改了，就需要对 <code>DOM</code> 结构进行重新计算，重新布局界面，再次引发回流，只是这个结构更改程度会决定周边 <code>DOM</code> 更改范围，即全局范围和局部范围，全局范围就是从根节点 <code>html</code> 开始对整个渲染树进行重新布局，例如当我们改变了窗口尺寸或者方向，或是修改了根元素的尺寸或字体大小等；而局部布局可以是对渲染树的某部分或某一个对象进行重新布局。</p> <p>会引起重排的操作有：</p> <ul><li>页面首次渲染</li> <li>浏览器窗口发生改变</li> <li>元素尺寸或位置变化</li> <li>元素内容、字体大小变化</li> <li>添加删除可见的 <code>DOM</code> 元素</li> <li>激活 <code>CSS</code> 伪类</li> <li>设置 <code>style</code> 属性</li> <li>查询某些属性或调用方法</li></ul> <table><thead><tr><th>常见引起重排属性和方法</th> <th></th> <th></th></tr></thead> <tbody><tr><td>width</td> <td>height</td> <td>margin</td></tr> <tr><td>display</td> <td>border</td> <td>position</td></tr> <tr><td>clientWidth</td> <td>clientHeight</td> <td>clientTop</td></tr> <tr><td>offsettWidth</td> <td>offsetHeight</td> <td>offsetTop</td></tr> <tr><td>scollWidth</td> <td>scollHeight</td> <td>scollTop</td></tr> <tr><td>scollIntoView()</td> <td>scollTo()</td> <td>getComputedStyle()</td></tr> <tr><td>getBoundingClientRect()</td> <td>scollIntoViewIfNeeded()</td> <td></td></tr></tbody></table> <h2 id="重绘（repainting）"><a href="#重绘（repainting）" aria-hidden="true" class="header-anchor">#</a> 重绘（Repainting）</h2> <p>相比重排，重绘要简单得多，所谓重绘，就是当页面中元素样式的改变并不影响它在文档流中的位置时，例如改变了字体颜色，浏览器会将新样式赋予给元素并重新绘制的过程。</p> <table><thead><tr><th>常见引起重绘属性</th> <th></th> <th></th> <th></th></tr></thead> <tbody><tr><td>color</td> <td>border-style</td> <td>visibility</td> <td>background</td></tr> <tr><td>text-decoration</td> <td>background-image</td> <td>background-position</td> <td>background-repeat</td></tr> <tr><td>outline-color</td> <td>outline</td> <td>outline-style</td> <td>border-radius</td></tr> <tr><td>outline-width</td> <td>box-shadow</td> <td>background-size</td> <td></td></tr></tbody></table> <h2 id="性能优化"><a href="#性能优化" aria-hidden="true" class="header-anchor">#</a> 性能优化</h2> <p>我们知道操作 <code>DOM</code> 是一个高成本的操作，不仅是因为本身 <code>JS</code> 与 <code>DOM</code> 的链接访问，还包括操作 <code>DOM</code> 后会引起一连串的连锁反应（重排），因此从性能优化的角度，可以从以下方面入手：</p> <ul><li><p>减少 <code>DOM</code> 操作</p> <ul><li>最小化 <code>DOM</code> 访问次数，尽量缓存访问 <code>DOM</code> 的样式信息，避免过度触发回流。</li> <li>如果在一个局部方法中需要多次访问同一个 <code>DOM</code> ，则先暂存它的引用。</li></ul></li> <li><p>采用更优的 <code>API</code> 替代高消费的 <code>API</code> ，转换优化消费高的集合</p> <ul><li>用 <code>querySelectorAll()</code> 代替 <code>getElementByXX()</code> ；</li> <li>开启动画的 <code>GPU</code> 加速，把渲染计算交给 <code>GPU</code> ;</li> <li>少用 <code>HTML</code> 集合（类数组）来遍历，因为集合遍历比真数组遍历耗费更高；</li> <li>用事件委托来减少事件处理器的数量。</li></ul></li> <li><p>减少重排</p> <ul><li>避免设置大量的 <code>style</code> 属性，因为设置 <code>style</code> 属性改变节点样式的话，每一次设置都会触发一次 <code>reflow</code> ，最好使用 <code>class</code> 属性；</li> <li>实现元素动画时最好设置 <code>position</code> 为 <code>fixed</code> 或 <code>absolute</code> ，这样不会影响其他元素布局；</li> <li>动画实现的速度的选择。比如实现一个动画，以 1 像素为单位移动最平滑，但这样 <code>reflow</code> 就会过于频繁，大量消耗 <code>CPU</code> 资源，如果以 3 像素移动则会好很多；</li> <li>不要使用 <code>table</code> 布局，因为 <code>table</code> 中某个元素触发了 <code>reflow</code> ，那么整个 <code>table</code> 元素都会触发。在不得已使用 <code>table</code> 元素的场合，也可以设置 <code>table-layout: auto</code> 或者 <code>table-layout: fixed</code> ，这样可以让 <code>table</code> 一行一行地渲染，限制 <code>reflow</code> 的影响范围。</li></ul></li> <li><p><code>css</code> 以及动画处理</p> <ul><li>少用 <code>css</code> 表达式</li> <li>减少通过 <code>JavaScript</code> 代码修改样式，尽量使用修改 <code>class</code> 名的操作方式；</li> <li>动画尽量用在绝对定位或固定定位的元素上；</li> <li>隐藏在屏幕外，或在页面滚动时，尽量停止动画。</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dj-blog/browsersMD/" class="prev router-link-active">首页</a></span> <span class="next"><a href="/dj-blog/browsersMD/http/HTTP.html">HTTP</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/dj-blog/assets/js/app.5965bf92.js" defer></script><script src="/dj-blog/assets/js/2.6df7a54b.js" defer></script><script src="/dj-blog/assets/js/8.c3ac8272.js" defer></script>
  </body>
</html>
